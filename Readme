NAME
       videocache - Squid url rewriter plugin to cache dynamic audio/video content from different video portals/websites.


DESCRIPTION
       videocache  is  a  squid  url  rewriter plugin written in Python to facilitate youtube, metacafe, dailymotion, google, vimeo, redtube,
       xtube, youporn, msn soapbox, tube8, tvuol.uol.com.br, blip.tv, break.com videos and wrzuta.pl audio caching. It can cache videos  from
       various  websites  in a separate directory (other than squid cache), in a browsable fashion and can serve the subsequent requests from
       the cache. It helps in saving bandwidth and loading time of the videos. videocache is currently used by many ISPs.


DEPENDENCIES
         1. squid >= 2.6
         2. python >= 2.4
         3. python-iniparse
         4. Apache or any other Web Server


CONFIGURATION
       To use videocache, you need to configure Proxy Server (squid) and the global videocache configuration file. Below  are  the  steps  to
       configure videocache.


   SQUID CONFIGURATION
       To  configure  squid to use videocache as a url rewriter program, you need to add the following lines to your squid configuration file
       (generally found at /etc/squid/squid.conf):

# --BEGIN-- videocache config for squid
url_rewrite_program /usr/bin/python /usr/share/videocache/videocache.py
url_rewrite_children 15 startup=15

# Youtube
acl videocache_allow_url url_regex -i \.youtube\.com\/videoplay \.youtube\.com\/get_video\?
acl videocache_allow_url url_regex -i \.youtube\.[a-z][a-z]\/videoplay \.youtube\.[a-z][a-z]\/get_video\?
acl videocache_allow_url url_regex -i \.youtube\.[a-z][a-z]\.[a-z][a-z]\/videoplay \.youtube\.[a-z][a-z]\.[a-z][a-z]\/get_video\?
# Google
acl videocache_allow_url url_regex -i \.googlevideo\.com\/videoplay \.googlevideo\.com\/get_video\?
acl videocache_allow_url url_regex -i \.google\.com\/videoplay \.google\.com\/get_video\?
acl videocache_allow_url url_regex -i \.google\.[a-z][a-z]\/videoplay \.google\.[a-z][a-z]\/get_video\?
acl videocache_allow_url url_regex -i \.google\.[a-z][a-z]\.[a-z][a-z]\/videoplay \.google\.[a-z][a-z]\.[a-z][a-z]\/get_video\?
# Metacafe
acl videocache_allow_url url_regex -i \.mccont\.com\/ItemFiles\/(.*)?\.(flv|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
# Dailymotion
acl videocache_allow_url url_regex -i proxy[a-z0-9\-]?[a-z0-9]?[a-z0-9]?[a-z0-9]?\.dailymotion\.com\/(.*)\.(flv|on2|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
acl videocache_allow_url url_regex -i vid\.akm\.dailymotion\.com\/(.*)\.(flv|on2|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
acl videocache_allow_url url_regex -i cdn\.dailymotion\.com\/(.*)\.(flv|on2|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
# Redtube
acl videocache_allow_url url_regex -i redtube\.com\/(.*)\.(flv|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
# Xtube
acl videocache_allow_url url_regex -i \.xtube\.com\/(.*)\.(flv|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
acl videocache_deny_url  url_regex -i \.xtube\.com\/(.*)(Thumb|videowall)
# Vimeo
acl videocache_allow_url url_regex -i \.vimeo\.com\/(.*)\.(flv|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
acl videocache_allow_url url_regex -i \.amazonaws\.com\/(.*)\.vimeo\.com(.*)\.(flv|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
# Wrzuta
acl videocache_allow_url url_regex -i c\.wrzuta\.pl\/(.*)\.(flv|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
acl videocache_allow_url url_regex -i c\.wrzuta\.pl\/wa[0-9][0-9]?[0-9]?[0-9]?[0-9]?
# Youporn
acl videocache_allow_url url_regex -i \.youporn\.com\/(.*)\.(flv|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
# Bing
acl videocache_allow_url url_regex -i msn\.com\/(.*)\.(flv|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
acl videocache_allow_url url_regex -i msn\.(.*)\.(com|net)\/(.*)\.(flv|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
acl videocache_allow_url url_regex -i msnbc\.(.*)\.(com|net)\/(.*)\.(flv|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
# Tube8
acl videocache_allow_url url_regex -i \.tube8\.com\/(.*)\.(flv|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
# Blip TV
acl videocache_allow_url url_regex -i \.blip\.tv\/(.*)\.(flv|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
acl videocache_deny_url  url_regex -i \.blip\.tv\/(.*)filename
# Break
acl videocache_allow_url url_regex -i \.break\.com\/(.*)\.(flv|mp4|avi|mkv|mp3|rm|rmvb|m4v|mov|wmv|3gp|mpg|mpeg)
# General
acl videocache_deny_url  url_regex -i crossdomain.xml
acl videocache_method method GET
# Access Rules
url_rewrite_access deny  videocache_deny_url
url_rewrite_access allow videocache_method videocache_allow_url
url_rewrite_access deny all
url_rewrite_bypass on
# --END-- videocache config for squid


       After changes, reload or restart the squid service using the command:

         [root@localhost ~]# service squid reload [ENTER]


       OR

         [root@localhost ~]# service squid restart [ENTER]



   VIDEO-CACHE GLOBAL CONFIGURATION
       Config file : /etc/videocache.conf


       enable_video_cache
              This option controls the global behavior of videocache plugin. If it is 0, videocache will stop caching  or  serving  anything.
              This option’s value can be either 0 or 1. Default 1.


       cache_host
              The  hostname  or  IP address of the system on which caching is being done. This is used for serving the videos from the cache.
              Please don’t use http:// or slashes (/). Just specify the domain name or IP address. Default: 127.0.0.1.  Additionally you can
              select an alternative port to use.
                Example : localhost.localdomain
                or proxy.example.com
                or 192.168.36.204
                or 192.168.36.204:81
                or <Proxy_Server_IP_OR_Domain>



       proxy  Warning : _USE_THIS_ONLY_IF_ Videocache Server should go via anohter proxy.  Proxy for http content. Default: <blank>.

                Example : http_proxy = http://<Proxy_Server_IP_OR_Domain>:<Proxy_port>/
                or http://proxy.example.com:3128/



       proxy_username
              If the above proxy requires authentication, please specify the username. Default: <blank>.


       proxy_password
              If the above proxy requires authentication, please specify the password. Default: <blank>.


       hit_threshold
              No of times a video should be requested before we start caching it. Default: 2


       base_dir
              Base  directories for caching the videos. You can specify multiple caching directories here separated by ’|’ symbol. Please try
              to avoid special characters in directory names like spaces, $ etc. For Example : base_dir =  /var/spool/videocache/  |  /video-
              cache2/stuff-new/|/new_videocache . Default: /var/spool/videocache/.


       temp_dir
              Directory  to  store  partially  downloaded videos. Directory name is relative to base_dir. E.g. if you specify temp_dir = tmp,
              actual path for storing partially downloaded videos would be /var/spool/videocache/tmp/. Default: tmp.


       enable_videocache_cleaner
              Enable the videocache cleaner script which will remove videos from cache which have not been used since long. The value of this
              option can be 0 or 1. Default: 0


       video_lifetime
              The  maximum  life  of  a video in cache without being used. If the video was not accessed for more than ’video_lifetime’ days,
              it’ll be removed from the cache. The unit of video_lifetime is days. For Example : video_lifetime = 3 will remove videos  which
              were not used since last 3 or more days. Default: 60


       max_parallel_downloads
              The maximum number of parallel downloads allowed. If all connections are consumed, videos will be queued for download. Default:
              30.


       logdir Directory where videocache logs will be stored. Default: /var/log/videocache/.


       max_logfile_size
              Maximum size of logfile specified above. The size is in megabytes. Don’t use  max_logfile_size  =  10MB.  Don ’t  append  MB.
              Default: 10.


       max_logfile_backups
              The  logfiles  are  automatically  rotated  once  they have exceeded the max_logfile_size. max_logfile_backups is the number of
              backup files you want to keep.  e.g. max_logfile_backups = 2 will keep videocache.log and videocache.log.1 and videocache.log.2
              as logfiles. Default: 10.


       rpc_host
              XMLRPCServer  is  used for memory sharing across different instances of videocache. Leave these settings as it is if you don’t
              have a fair idea of XMLRPCServer. This will be same as cache_host in almost all the cases. Default: 127.0.0.1.


       rpc_port
              Please make sure this port is not currently in use. If it is in use by some other program, change this to some port above  1024
              which is not in use by any other program. Default: 9100.


       enable_youtube_cache
              This option enables the caching of youtube videos. This option’s value can be either 0 or 1. Default: 1.


       youtube_cache_dir
              Directory  to  cache  youtube  videos. Directory name is relative to base_dir. E.g. if you specify youtube_cache_dir = youtube,
              actual path for caching youtube videos would be /var/spool/videocache/youtube/. Default: youtube.


FILES
         /etc/videocache.conf
         /etc/httpd/conf.d/videocache.conf OR /etc/apache2/conf.d/videocache.conf
         /usr/share/videocache/
         /usr/share/man/man8/videocache.8.gz
         /usr/sbin/update-vc
         /usr/sbin/vccleaner
         /var/log/videocache/
         /var/spool/videocache/


SEE ALSO
         squid (8)

         Project Website : http://cachevideos.com/
         How to configure squid : http://gofedora.com/how-to-configure-squid-proxy-server/
         How to write custom squid redirector in python : http://gofedora.com/how-to-write-custom-redirector-rewritor-plugin-squid-python/


AUTHOR
         Kulbir Saini <saini AT saini.co.in>



BUGS, SUGGESTIONS, COMMENTS
         Please visit http://cachevideos.com/forum/.
